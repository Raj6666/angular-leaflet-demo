<!-- 2017-12-12 13:01:51 | 版权所有 合肥火星科技有限公司 http://www.marsgis.cn  【联系我们QQ：516584683】 -->
<!DOCTYPE html><html><head><title>Extending Leaflet, New Handlers and Controls - Leaflet - a JavaScript library for interactive maps</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" type="image/x-icon" href="../../docs/images/favicon.ico"><link href="http://leafletjs.com/atom.xml" type="application/atom+xml" rel="alternate" title="Leaflet Dev Blog Atom Feed"><link rel="stylesheet" href="../../docs/css/normalize.css"><link rel="stylesheet" href="../../docs/css/main.css"><link href="http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700,300" rel="stylesheet"><script src="../../docs/highlight/highlight.pack.js"></script><link rel="stylesheet" href="../../docs/highlight/styles/github-gist.css"><link rel="stylesheet" href="../../docs/lib/leaflet.css"><script src="../../docs/lib/leaflet.js"></script><script>ACCESS_TOKEN="pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",MB_ATTR='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',MB_URL="https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg?access_token="+ACCESS_TOKEN,OSM_URL="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.jpg",OSM_ATTRIB='&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors'</script></head><body><div class="container"><p class="tutorials-back"><a href="../../examples.html">&larr; 所有教程</a></p><p><br></p><p>本教程假定您已阅读了<a href="./extending-1-classes.html">Leaflet类及继承关系</a>的理论。</p><p>In Leaflet, a &#8220;layer&#8221; is anything that moves with the map. In contraposition to that, a &#8220;control&#8221; is a HTML element that remains static relative to the map container, and a &#8220;handler&#8221; is a piece of invisible code that changes the map&#8217;s behaviour.</p><h2 id="handlers">Handlers</h2><p>Map handlers are a new concept in Leaflet 1.0, and their function is to process DOM events from the browser (like <code class="highlighter-rouge">click</code>, <code class="highlighter-rouge">dblclick</code> or <code class="highlighter-rouge">mousewheel</code>) and change the state of the map.</p><p>Handlers are relatively simple: they just need a <code class="highlighter-rouge">addHooks()</code> method (which runs when the handler is enabled in a map) and a <code class="highlighter-rouge">removeHooks()</code>, which runs when the handler is disabled. A skeleton for handlers is:</p><div class="highlighter-rouge"><pre class="highlight"><code>L.CustomHandler = L.Handler.extend({
	addHooks: function() {
		L.DomEvent.on(document, 'eventname', this._doSomething, this);
	},
	removeHooks: function() {
		L.DomEvent.off(document, 'eventname', this._doSomething, this);
	},
	_doSomething: function(event) { … }
});
</code></pre></div><p>This can be illustrated with a simple handler to pan the map when a mobile device is tilted, through <a href="https://developer.mozilla.org/en-US/docs/Web/API/Detecting_device_orientation"><code class="highlighter-rouge">deviceorientation</code> events</a>:</p><div class="highlighter-rouge"><pre class="highlight"><code>L.TiltHandler = L.Handler.extend({
	addHooks: function() {
		L.DomEvent.on(window, 'deviceorientation', this._tilt, this);
	},
	removeHooks: function() {
		L.DomEvent.off(window, 'deviceorientation', this._tilt, this);
	},
	_tilt: function(ev) {
		// Treat Gamma angle as horizontal pan (1 degree = 1 pixel) and Beta angle as vertical pan
		this._map.panBy( L.point( ev.gamma, ev.beta ) );
	}
});
</code></pre></div><p>The handler can be attached to the map using <code class="highlighter-rouge">map.addHandler('tilt', L.TiltHandler)</code> - this will store an instance of <code class="highlighter-rouge">L.TiltHandler</code> as <code class="highlighter-rouge">map.tilt</code>. However, it&#8217;s more usual to attach handlers to all maps with the <code class="highlighter-rouge">addInitHook</code> syntax:</p><div class="highlighter-rouge"><pre class="highlight"><code>L.Map.addInitHook('addHandler', 'tilt', L.TiltHandler);
</code></pre></div><p>Our handler can now be enabled by running <code class="highlighter-rouge">map.tilt.enable()</code> and disabled by <code class="highlighter-rouge">map.tilt.disable()</code></p><p>Moreover, if the map has a property named the same as the handler, then that handler will be enabled by default if that options is <code class="highlighter-rouge">true</code>, so this will enable our handler by default:</p><div class="highlighter-rouge"><pre class="highlight"><code>var map = L.map('mapDiv', { tilt: true });
</code></pre></div><p>To see this example, you&#8217;ll need a mobile browser which <a href="http://caniuse.com/#search=deviceorientation">supports the <code class="highlighter-rouge">deviceorientation</code> event</a> - and even so, this event is particularly flaky and ill-specified, so beware.</p><table><tr><td style="text-align:center;border:none"><iframe src="tilt.html" width="616" height="416"></iframe></td></tr><tr><td style="text-align:center;border:none"><small><a href="tilt.html" target="_blank">单独打开页面查看这个例子</a></small></td></tr></table><p>Depending on the type of event, a map handler can attach event listeners to the <code class="highlighter-rouge">document</code>, the <code class="highlighter-rouge">window</code>, or the container of the <code class="highlighter-rouge">L.Map</code> it&#8217;s attached to.</p><h2 id="controls">Controls</h2><p>You already know controls - the zoom control in the top left corner, the scale at the bottom left, the layer switcher at the top right. At their core, an <code class="highlighter-rouge">L.Control</code> is an HTML Element that is at a static position in the map container.</p><p>To make a control, simply inherit from <code class="highlighter-rouge">L.Control</code> and implement <code class="highlighter-rouge">onAdd()</code> and <code class="highlighter-rouge">onRemove()</code>. These methods work in a similar way to their <code class="highlighter-rouge">L.Layer</code> counterparts (they run whenever the control is added to or removed from the map), except that <code class="highlighter-rouge">onAdd()</code> must return an instance of <code class="highlighter-rouge">HTMLElement</code> representing the control. Adding the element to the map is done automatically, and so is removing it.</p><p>The simplest example of a custom control would be a watermark, which is just an image:</p><div class="highlighter-rouge"><pre class="highlight"><code>L.Control.Watermark = L.Control.extend({
	onAdd: function(map) {
		var img = L.DomUtil.create('img');
		img.src = '../../docs/images/logo.png';
		img.style.width = '200px';
		return img;
	},
	onRemove: function(map) {
		// Nothing to do here
	}
});
L.control.watermark = function(opts) {
	return new L.Control.Watermark(opts);
}
L.control.watermark({ position: 'bottomleft' }).addTo(map);
</code></pre></div><table><tr><td style="text-align:center;border:none"><iframe src="watermark.html" width="616" height="416"></iframe></td></tr><tr><td style="text-align:center;border:none"><small><a href="watermark.html" target="_blank">单独打开页面查看这个例子</a></small></td></tr></table><p>If your custom control has interactive elements such as clickable buttons, remember to use <code class="highlighter-rouge">L.DomEvent.on()</code> inside <code class="highlighter-rouge">onAdd()</code> and <code class="highlighter-rouge">L.DomEvent.off()</code> inside <code class="highlighter-rouge">onRemove()</code>.</p><p>If your custom control consists of more than one HTML element (like <code class="highlighter-rouge">L.Control.Zoom</code>, which has two buttons), you&#8217;ll have to create the whole hierarchy of elements and return the topmost container.</p><h2 id="publishing-your-plugin">Publishing your plugin</h2><p>If you have understood everything so far, you&#8217;re ready to make som Leaflet plugins! But make sure to read the <a href="https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md"><code class="highlighter-rouge">PLUGIN-GUIDE.md</code> file</a>, as it contains some tips and good practices about naming and publishing your plugin.</p><div class="footer"><p>&copy; 版权所有 <a href="http://leafletjs.com" target="_blank">Leaflet </a>&nbsp; &nbsp; 翻译<a href="http://www.marsgis.cn" target="_blank">合肥火星科技</a></p></div></div><script>hljs.configure({tabReplace:"    "}),hljs.initHighlighting(),function(){if(document.body.className.indexOf("api-page")!==-1)for(var i=document.getElementsByTagName("h2"),n=0,e=i.length;n<e;n++)i[n].id&&(i[n].onclick=function(i){i.offsetX<0&&(window.location.hash="#"+this.id)})}()</script><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-4147697-4"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="../../docs/js/docs.js"></script></body></html>